<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Timeline Galerie</title>
  <style>
:root {
  --vh: 1vh;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  overflow: hidden;
  font-family: sans-serif;
}

.timeline-container {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  height: calc(var(--vh) * 100);
  padding: 0;
}

.timeline-photo {
  flex: 0 0 auto;
  scroll-snap-align: center;
  position: relative;
  aspect-ratio: 2 / 3;
  max-height: calc(var(--vh) * 100);
  max-width: 100vw;
  overflow: hidden;
}

.timeline-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
  display: block;
}

.timeline-caption {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  color: white;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.3));
  backdrop-filter: blur(6px);
  padding: 1em;
  font-size: 1em;
  line-height: 1.5em;
  max-height: calc(1.5em * 2 + 1em * 2 + 0.15em); /* výška 2 řádků + padding + spacer */
  overflow: hidden;
  transition: max-height 0.3s ease;
}

/* Zkrácený text na 2 řádky */
.timeline-caption-text {
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Spacer ve zkráceném režimu */
.timeline-caption-spacer {
  height: 0.15em;
}

/* Přidáme "..." vizuálně */
.timeline-caption::after {
  content: '...';
  white-space: pre;
  position: absolute;
  bottom: 0.8em;
  right: 1em;
  color: white;
  pointer-events: none;
}

/* Po rozbalení */
.timeline-caption.expanded {
  max-height: 100%;
  background: rgba(0, 0, 0, 0.7);
  overflow-y: auto;
}

/* Zrušíme zkrácení textu */
.timeline-caption.expanded .timeline-caption-text {
  display: block;
  -webkit-line-clamp: unset;
  overflow: visible;
}

/* Schováme spacer a ... */
.timeline-caption.expanded .timeline-caption-spacer {
  display: none;
}

.timeline-caption.expanded::after {
  display: none;
}
  </style>
</head>
<body>

<div class="timeline-container" id="timeline">
  <div class="timeline-photo">
    <img src="https://picsum.photos/id/1011/600/900" loading="lazy" alt="">
    <div class="timeline-caption" onclick="toggleCaption(this)">
      <div class="timeline-caption-text">
      i Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum eu rhoncus sem. Sed egestas quis leo eu finibus. Praesent vitae purus sapien. Donec rhoncus felis diam, quis faucibus elit egestas luctus. Sed et euismod elit. In consectetur eros lacus, eget vulputate felis porttitor ut. In sit amet varius eros.
      </div>
      <div class="timeline-caption-spacer"></div>
    </div>
  </div>
  <div class="timeline-photo">
    <img src="https://picsum.photos/id/1015/600/900" loading="lazy" alt="">
    <div class="timeline-caption" onclick="toggleCaption(this)">
      <div class="timeline-caption-text">
      ii Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum eu rhoncus sem. Sed egestas quis leo eu finibus. Praesent vitae purus sapien. Donec rhoncus felis diam, quis faucibus elit egestas luctus. Sed et euismod elit. In consectetur eros lacus, eget vulputate felis porttitor ut. In sit amet varius eros.
      </div>
      <div class="timeline-caption-spacer"></div>
    </div>
  </div>
  <div class="timeline-photo">
    <img src="https://picsum.photos/id/1016/600/900" loading="lazy" alt="">
    <div class="timeline-caption" onclick="toggleCaption(this)">
      <div class="timeline-caption-text">
      iii Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum eu rhoncus sem. Sed egestas quis leo eu finibus. Praesent vitae purus sapien. Donec rhoncus felis diam, quis faucibus elit egestas luctus. Sed et euismod elit. In consectetur eros lacus, eget vulputate felis porttitor ut. In sit amet varius eros.
      </div>
      <div class="timeline-caption-spacer"></div>
    </div>
  </div>
  <div class="timeline-photo">
    <img src="https://picsum.photos/id/1028/600/900" loading="lazy" alt="">
    <div class="timeline-caption" onclick="toggleCaption(this)">
      <div class="timeline-caption-text">
      iv Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum eu rhoncus sem. Sed egestas quis leo eu finibus. Praesent vitae purus sapien. Donec rhoncus felis diam, quis faucibus elit egestas luctus. Sed et euismod elit. In consectetur eros lacus, eget vulputate felis porttitor ut. In sit amet varius eros.
      </div>
      <div class="timeline-caption-spacer"></div>
    </div>
  </div>
  <div class="timeline-photo">
    <img src="https://picsum.photos/id/1025/600/900" loading="lazy" alt="">
    <div class="timeline-caption" onclick="toggleCaption(this)">
      <div class="timeline-caption-text">
      v Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum eu rhoncus sem. Sed egestas quis leo eu finibus. Praesent vitae purus sapien. Donec rhoncus felis diam, quis faucibus elit egestas luctus. Sed et euismod elit. In consectetur eros lacus, eget vulputate felis porttitor ut. In sit amet varius eros.
      </div>
      <div class="timeline-caption-spacer"></div>
    </div>
  </div>
</div>

<script>
  // Dynamické nastavení vh
  function setRealViewportHeight() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }

  window.addEventListener('resize', setRealViewportHeight);
  window.addEventListener('load', setRealViewportHeight);

  // Rozbalení titulku
  function toggleCaption(caption) {
    caption.classList.toggle("expanded");
  }

  // Horizontální posuv
  const timeline = document.getElementById('timeline');
  let isDown = false;
  let startX, scrollLeft;

  timeline.addEventListener('mousedown', (e) => {
    isDown = true;
    startX = e.pageX - timeline.offsetLeft;
    scrollLeft = timeline.scrollLeft;
  });

  timeline.addEventListener('mouseleave', () => {
    isDown = false;
  });

  timeline.addEventListener('mouseup', () => {
    isDown = false;
    snapToCenter();
  });

  timeline.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const x = e.pageX - timeline.offsetLeft;
    const walk = (x - startX) * 1;
    timeline.scrollLeft = scrollLeft - walk;
  });

  timeline.addEventListener('wheel', (e) => {
    e.preventDefault();
    timeline.scrollLeft += e.deltaY;
    clearTimeout(timeline.snapTimeout);
    timeline.snapTimeout = setTimeout(snapToCenter, 200);
  }, { passive: false });

  // Zarovnání na nejbližší fotku
  function snapToCenter() {
    const photos = timeline.querySelectorAll('.timeline-photo');
    let closest = null;
    let closestDistance = Infinity;
    const center = timeline.scrollLeft + timeline.offsetWidth / 2;

    photos.forEach(photo => {
      const rect = photo.getBoundingClientRect();
      const photoCenter = rect.left + rect.width / 2;
      const distance = Math.abs(photoCenter - window.innerWidth / 2);
      if (distance < closestDistance) {
        closestDistance = distance;
        closest = photo;
      }
    });

    if (closest) {
      closest.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }
  }
</script>

</body>
</html>